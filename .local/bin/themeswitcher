#!/bin/dash
#
# Theme Switcher
#
#startup apps (polybar) 
# env variables for filepaths
#
#apps (xmonad, rofi)
# links to files are placed in the applicatonfolders
#
#Autostart in ~/.xinitrc
# The ThemeSwitcher Script will be executed in xinitrc to apply the default theme 
# but with the -no-x flag

settheme () {
		echo applying theme $wanted_theme

		# Set the Theme #
		ln -sf $themepath/dmenu ~/.config/dmenu/color
		ln -sf $themepath/theme.rasi ~/.config/rofi/
		ln -sf $(cat $themepath/feh) ~/.config/feh/background

		# Recompile Xmonad
		ln -sf $themepath/theme.hs ~/.xmonad/lib/Theme.hs
		xmonad --recompile

		# log the new active theme
		echo $wanted_theme > $themesfolder/active
		return 0
}

restartxapps () {
		echo restarting the xorg applications
		## Restart the Applications ###
		#Feh
		feh --bg-scale --no-fehbg ~/.config/feh/background

		#Polybar
		#COLOR=$(cat $themepath/polybar) ~/.config/polybar/launch.sh &> /dev/null &

		#Xmonad
		xmonad --restart

}
	
ask () {
		confirmation=$(printf "no\nyes\n" | tdmenu -p "activate $wanted_theme theme?")
		[ $confirmation = "yes" ] && return 0;
		return 1;
}

wanted_theme=$1
set_option=$2

themepath=~/.config/desktop-themes/$wanted_theme
themesfolder=~/.config/desktop-themes/

#prove selected theme 
[ -z $wanted_theme ] && echo no theme selected. && exit; 
ls  $themepath 1>/dev/null 2>/dev/null
[ ! $? -eq 0 ] && echo selected theme not valid. && exit;

#check if theme is already active
[ $wanted_theme = $(cat $themesfolder/active) ] && echo selected theme already active &&exit

	
if [ $set_option -z ] ; then
		ask
		[ $? -eq 1 ] && echo not applying. && exit
		settheme
		restartxapps
elif [ $set_option = "--no-x" ] ; then
		settheme
fi



